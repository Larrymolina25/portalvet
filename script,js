let mascotas = [];

function registrarMascota() {
    // Obtener datos del formulario
    const nombre = document.getElementById("nombreMascota").value;
    const raza = document.getElementById("raza").value;
    const edad = document.getElementById("edad").value;
    const color = document.getElementById("color").value;
    const vacuna = document.getElementById("vacunas").value;
    const fechaVacuna = document.getElementById("fechaVacuna").value;
    const veterinario = document.getElementById("veterinario").value;
    const desparasitacion = document.getElementById("desparasitacion").value;
    const fechaDesparasitacion = document.getElementById("fechaDesparasitacion").value;
    const examenes = document.getElementById("examenes").value;

    // Crear un objeto con la información de la mascota
    const mascota = {
        nombre,
        raza,
        edad,
        color,
        carnetVacunacion: {
            vacuna,
            fechaVacuna,
            veterinario,
            desparasitacion,
            fechaDesparasitacion,
        },
        historialMedico: examenes,
    };

    // Agregar la mascota al arreglo
    mascotas.push(mascota);

    // Actualizar la vista previa y las estadísticas
    mostrarMascotasRegistradas();
    actualizarEstadisticas();
}

function mostrarMascotasRegistradas() {
    const contenedor = document.getElementById("mascotas-registradas");
    contenedor.innerHTML = mascotas.map(mascota => `
        <div class="mascota">
            <h4>${mascota.nombre} (${mascota.raza})</h4>
            <p><strong>Edad:</strong> ${mascota.edad} años</p>
            <p><strong>Color:</strong> ${mascota.color}</p>
            <h5>Carnet de Vacunación</h5>
            <p><strong>Vacuna:</strong> ${mascota.carnetVacunacion.vacuna} (${mascota.carnetVacunacion.fechaVacuna})</p>
            <p><strong>Veterinario:</strong> ${mascota.carnetVacunacion.veterinario}</p>
            <p><strong>Desparasitación:</strong> ${mascota.carnetVacunacion.desparasitacion || "No aplica"} (${mascota.carnetVacunacion.fechaDesparasitacion || "No aplica"})</p>
            <h5>Historial Médico</h5>
            <p>${mascota.historialMedico || "No hay historial médico registrado"}</p>
        </div>
    `).join("");
}

function actualizarEstadisticas() {
    const ctx = document.getElementById("chartCanvas").getContext("2d");
    const razas = mascotas.reduce((acc, mascota) => {
        acc[mascota.raza] = (acc[mascota.raza] || 0) + 1;
        return acc;
    }, {});

    new Chart(ctx, {
        type: "bar",
        data: {
            labels: Object.keys(razas),
            datasets: [{
                label: "Cantidad de Mascotas",
                data: Object.values(razas),
                backgroundColor: "#4CAF50",
            }],
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
            },
        },
    });
}
